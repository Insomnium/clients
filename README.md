# Welcome to CodeBattle: Bomberman
## Как это работает?
Необходимо подключиться из кода к серверу через вебсокет по адресу:
`ws://${server_host}:${server_port}/codenjoy-contest/ws?user=${email}&code=${auth_code}`
- `email` - email, указанынй при регистрации
- `code` - автоматически сгенерированный код. Виден в query parameters в адресной строке браузера *(после регистрации)*

После подключения, клиент через вебсокет будет регулярно (каждую секунду) получать строку символов с закодированным состоянием игрового поля. 
Само игровое поле извлекается из ответа сервера регулярным выражением:
```
^board=(.*)$
```
Пример ответа сервера с игровым полем:

```
board=☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼ #   # #  #♥#  #  #  &        #☼☼♥☼♥☼♥☼#☼ ☼ ☼ ☼ ☼♥☼ ☼ ☼#☼#☼♥☼#☼#☼☼#♥♥  ♥#   # #♥   # ♥#          ☼☼ ☼ ☼#☼ ☼♥☼ ☼ ☼#☼ ☼ ☼ ☼ ☼&☼ ☼ ☼ ☼☼     ♥          # #            ☼☼ ☼ ☼ ☼ ☼♥☼ ☼ ☼♥☼#☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼☼#       # #       ☺& 2  #  #  #☼☼#☼♥☼ ☼#☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼#☼ ☼ ☼ ☼☼#  # ♥#               # ♥   #  ☼☼ ☼ ☼#☼#☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼#☼ ☼☼   #♥ #      #                 ☼☼ ☼ ☼ ☼ ☼♥☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼#☼☼     ## #     #   # #   ♥      ☼☼ ☼ ☼♥☼ ☼ ☼#☼ ☼#☼ ☼ ☼♥☼ ☼ ☼ ☼ ☼ ☼☼       #♥       #      ## # ###☼☼ ☼ ☼ ☼#☼ ☼ ☼#☼ ☼ ☼#☼#☼&☼ ☼ ☼ ☼ ☼☼       #       #    ♣# #     ♥ ☼☼ ☼ ☼ ☼♥☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼#☼ ☼☼        ## ## ♥             # #☼☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼☼                   &    ###  ##☼☼ ☼ ☼ ☼ ☼ ☼ ☼#☼ ☼#☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼☼                   ♥ ##        ☼☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼♥☼#☼ ☼ ☼ ☼☼     ##         &#         #   ☼☼ ☼ ☼ ☼#☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼#☼ ☼ ☼ ☼ ☼☼   #   #         #     # &     ☼☼♥☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼#☼#☼ ☼☼  #                    ##   &  ☼☼ ☼ ☼ ☼ ☼ ☼#☼ ☼ ☼ ☼ ☼ ☼ ☼#☼ ☼#☼ ☼☼ #    # &        #       #     ☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼
```
Длина строки без "board=" равна площади поля. Если вставить символ переноса строки каждые `sqrt(length(string))` символов, то получится читабельное "изображение" поля в ASCII:
```
☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼
☼ #   # #  #♥#  #  #  &        #☼
☼♥☼♥☼♥☼#☼ ☼ ☼ ☼ ☼♥☼ ☼ ☼#☼#☼♥☼#☼#☼
☼#♥♥  ♥#   # #♥   # ♥#          ☼
☼ ☼ ☼#☼ ☼♥☼ ☼ ☼#☼ ☼ ☼ ☼ ☼&☼ ☼ ☼ ☼
☼     ♥          # #            ☼
☼ ☼ ☼ ☼ ☼♥☼ ☼ ☼♥☼#☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼
☼#       # #       ☺& 2  #  #  #☼
☼#☼♥☼ ☼#☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼#☼ ☼ ☼ ☼
☼#  # ♥#               # ♥   #  ☼
☼ ☼ ☼#☼#☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼#☼ ☼
☼   #♥ #      #                 ☼
☼ ☼ ☼ ☼ ☼♥☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼#☼
☼     ## #     #   # #   ♥      ☼
☼ ☼ ☼♥☼ ☼ ☼#☼ ☼#☼ ☼ ☼♥☼ ☼ ☼ ☼ ☼ ☼
☼       #♥       #      ## # ###☼
☼ ☼ ☼ ☼#☼ ☼ ☼#☼ ☼ ☼#☼#☼&☼ ☼ ☼ ☼ ☼
☼       #       #    ♣# #     ♥ ☼
☼ ☼ ☼ ☼♥☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼#☼ ☼
☼        ## ## ♥             # #☼
☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼
☼                   &    ###  ##☼
☼ ☼ ☼ ☼ ☼ ☼ ☼#☼ ☼#☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼
☼                   ♥ ##        ☼
☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼♥☼#☼ ☼ ☼ ☼
☼     ##         &#         #   ☼
☼ ☼ ☼ ☼#☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼#☼ ☼ ☼ ☼ ☼
☼   #   #         #     # &     ☼
☼♥☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼ ☼#☼#☼ ☼
☼  #                    ##   &  ☼
☼ ☼ ☼ ☼ ☼ ☼#☼ ☼ ☼ ☼ ☼ ☼ ☼#☼ ☼#☼ ☼
☼ #    # &        #       #     ☼
☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼
```
Первый символ строки соответствует ячейке, расположенной в левом верхнем углу и имеет координату `[0, 0]`. Последний символ, 
соответственно, соответствует правому нижнему углу игрового поля `[n, n]` 
В этом примере — позиция бомбермена (символ ☺) — `[19,7]`.

Расшифровка символов игрового поля:

```

    /// This is your Bomberman
    BOMBERMAN('☺'),             // this is what he usually looks like
    BOMB_BOMBERMAN('☻'),        // this is if he is sitting on own bomb
    DEAD_BOMBERMAN('Ѡ'),        // oops, your Bomberman is dead (don't worry, he will appear
                                // somewhere in next move)
                                // you're getting -200 for each death

    /// this is other players Bombermans
    OTHER_BOMBERMAN('♥'),       // this is what other Bombermans looks like
    OTHER_BOMB_BOMBERMAN('♠'),  // this is if player just set the bomb
    OTHER_DEAD_BOMBERMAN('♣'),  // enemy corpse (it will disappear shortly, right on the next move)
                                // if you've done it you'll get +1000

    /// the bombs
    BOMB_TIMER_5('5'),          // after bomberman set the bomb, the timer starts (5 tacts)
    BOMB_TIMER_4('4'),          // this will blow up after 4 tacts
    BOMB_TIMER_3('3'),          // this after 3
    BOMB_TIMER_2('2'),          // two
    BOMB_TIMER_1('1'),          // one
    BOOM('҉'),                  // Boom! this is what is bomb does, everything that is destroyable
                                // got destroyed

    /// walls
    WALL('☼'),                  // indestructible wall - it will not fall from bomb
    DESTROY_WALL('#'),          // this wall could be blowed up
    DESTROYED_WALL('H'),        // this is how broken wall looks like, it will dissapear on next move
                                // if it's you did it - you'll get +10 points.

    /// meatchoppers
    MEAT_CHOPPER('&'),          // this guys runs over the board randomly and gets in the way all the time
                                // if it will touch bomberman - it will die
                                // you'd better kill this piece of ... meat, you'll get +100 point for it
    DEAD_MEAT_CHOPPER('x'),     // this is chopper corpse

    /// a void
    NONE(' ');                 // this is the only place where you can move your Bomberman
```

## Правила
Игра пошаговая: каждую секунду (1 игровой тик) сервер посылает через вебсокет твоему клиенту (боту) состояние обновленного игрового поля на момент окончания тика и ожидает ответ. 
За следующую секунду игрок должен успеть дать команду своему герою. Если не успел — герой останется стоять на месте (читай, ход пропущен).

### Как набирать очки 
Очки начисляются за следующие действия:
1. Разрушение кирпичной стены (`DESTROY_WALL`) - 10 очков
2. Убийство мит-чоппера (`MEAT_CHOPPER`) - 100 очков
3. Убийство другого игрока (`OTHER_BOMBERMAN`) - 1000 очков
4. (Optional) за смерть от собственной бомбы может быть выставлен пенальти

*Количество очков настраиваемо и может измениться прямо перед соревнованием ☺*  
*Перерасчет очков производится в конце игрового тика*

Побеждает игрок, набравший в конце установленного времени наибольшее количество очков.

## Протокол
**Websockets ☺**

Сервер умеет принимать на вход следующий набор команд:
1. `UP`, `DOWN`, `LEFT` или `RIGHT` - направление движения для следующего игрового тика
2. `ACT` - установка бомбы
3. Команды перемещения можно комбинировать с командой установки бомбы (`ACT`), конкатенируя их через запятую. Например, `ACT,UP` или `LEFT,ACT`.   
*Порядок команд* в таком случае (`LEFT,ACT` или `ACT,LEFT`) - *имеет значение*: либо двигаемся влево и там ставим бомбу, либо ставим бомбу а затем двигаемся влево. 
Если игрок будет использовать только команду `ACT`, бомба установится под героем без его перемещения на поле.

## Окей, попробуем почитить!  
1. Нет, более 2х команд подряд в одном тике не сработают ☹  
2. Нет, `ACT,ACT` (установка 2х бомб подряд) или `LEFT,UP` (две change-direction-команды подряд) не сработают - считай, что это пропуск хода 
3. Нет, нельзя плантить бомбу на каждом шаге - `ACT` не будет работать до тех пор, пока предыдущая поставленная тобой бомба не подорвется, либо пока твой игрок не умрет
4. Нет, если отправить невалидную команду, сервер не упадет  

#### FAQ
**Q:** Можно ли ходить сквозь бомбы/митчопперов/игроков?  
**A:** Нет. Кстати, если ты отправляешь только команду `ACT` - твой бомбермен остается стоять на бомбе, но ты можешь с неё спрыгнуть. Во всех остальных случаях ходить 
"сквозь" бомбы нелья. Это касается как твоих бомб, так и бомб соперников    
**Q:** Что будет, если 2 или более игрока подорвут другого игрока/митчоппера/разрушаемую стену одновременно?  
**A:** Очки будут начислены каждому из игроков, т.к. уничтоженные юниты не удаляются с карты с момента начала расчета и до окончания игрового тика   

